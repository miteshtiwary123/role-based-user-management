# User & Role Management API - FastAPI

A FastAPI-based backend for user management with:
- PostgreSQL + SQLAlchemy + Alembic
- JWT Authentication (Access + Refresh tokens)
- Role-based access control (RBAC)
- Pagination & filtering in CRUD endpoints
- Auto token renewal

---

## 🚀 Features
- User registration & login
- Access & Refresh token authentication
- Role-based route protection
- CRUD APIs for managing users
- Pagination & filtering for large datasets
- Automatic token expiration handling
- Swagger & Redoc API docs
- Unit tests with pytest + coverage

---

## 📦 Tech Stack
- **Backend:** FastAPI
- **Database:** PostgreSQL
- **ORM:** SQLAlchemy
- **Migrations:** Alembic
- **Auth:** JWT (PyJWT)
- **Testing:** pytest + coverage

---

## 🛠 Installation

### 1. Clone the repo
```bash
git clone https://github.com/your-username/fastapi-user-role-api.git
cd fastapi-user-role-api
```

### 2. Create & activate virtual environment
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

### 3. Install dependencies
```bash
pip install -r requirements.txt
```

### 4. Configure environment variables
Create a .env file
```bash
DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432/fastapi_db
SECRET_KEY=your_secret_key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
```

### 5. Run migrations
```bash
alembic upgrade head
```

### 6. Start server
```bash
uvicorn app.main:app --reload
```


## 📜 API Documentation

[Swagger UI](http://localhost:8000/docs)

[Redoc](http://localhost:8000/redoc)


## 🔐 API Examples

### Register User
```bash
curl -X POST http://localhost:8000/auth/register \
-H "Content-Type: application/json" \
-d '{"username": "john", "password": "pass123", "role": "user"}'
```

### Login
```bash
curl -X POST http://localhost:8000/auth/login \
-H "Content-Type: application/json" \
-d '{"username": "john", "password": "pass123"}'
```

### Get All Users (Admin only)
```bash
curl -X GET http://localhost:8000/users/ \
-H "Authorization: Bearer <ACCESS_TOKEN>"
```

## 🧪 Running Tests
```bash
pytest --cov=app --cov-report=term-missing
```

## 📊 ER Diagram
```
+-----------+ +---------------+
| users    |           | roles  |
+-----------+ +---------------+
| id (PK)  |        | id (PK)|
| name     |<-----> | name   |
| email    |
| password |
| role_id  |
+-----------+
```

## 📂 Project Structure
```
role-based-user-management/
│
├── app/
│   ├── __init__.py
│   ├── main.py
│   ├── core/
│   │   ├── __init__.py
│   │   ├──  config.py
│   │   ├── deps.py
│   │   └── security.py
│   ├── db/
│   │   ├── __init__.py
│   │   ├── session.py
│   │   └── base.py
│   ├── models/
│   │   ├── __init__.py
│   │   └── user.py
│   ├── schemas/
│   │   ├── __init__.py
│   │   ├── common.py
│   │   └── user.py
│   ├── crud/
│   │   ├── __init__.py
│   │   └── user.py
│   ├── routes/
│   │   ├── __init__.py
│   │   ├── auth.py
│   │   └── user.py
│   └── services/
│       ├── __init__.py
│       └── user_service.py
│
├── alembic/
│   └── (auto-generated by Alembic)
|
├── tests/
│    │
│    ├── __init__.py
│    ├── conftest.py
│    ├── test_auth.py
│    └── test_users.py
│
├── alembic.ini
├── requirements.txt
└── README.md
```