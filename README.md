# User & Role Management API - FastAPI

A FastAPI-based backend for user management with:
- PostgreSQL + SQLAlchemy + Alembic
- JWT Authentication (Access + Refresh tokens)
- Role-based access control (RBAC)
- Pagination & filtering in CRUD endpoints
- Auto token renewal

---

## ğŸš€ Features
- User registration & login
- Access & Refresh token authentication
- Role-based route protection
- CRUD APIs for managing users
- Pagination & filtering for large datasets
- Automatic token expiration handling
- Swagger & Redoc API docs
- Unit tests with pytest + coverage

---

## ğŸ“¦ Tech Stack
- **Backend:** FastAPI
- **Database:** PostgreSQL
- **ORM:** SQLAlchemy
- **Migrations:** Alembic
- **Auth:** JWT (PyJWT)
- **Testing:** pytest + coverage

---

## ğŸ›  Installation

### 1. Clone the repo
```bash
git clone https://github.com/your-username/fastapi-user-role-api.git
cd fastapi-user-role-api
```

### 2. Create & activate virtual environment
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

### 3. Install dependencies
```bash
pip install -r requirements.txt
```

### 4. Configure environment variables
Create a .env file
```bash
DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432/fastapi_db
SECRET_KEY=your_secret_key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7
```

### 5. Run migrations
```bash
alembic upgrade head
```

### 6. Start server
```bash
uvicorn app.main:app --reload
```


## ğŸ“œ API Documentation

[Swagger UI](http://localhost:8000/docs)

[Redoc](http://localhost:8000/redoc)


## ğŸ” API Examples

### Register User
```bash
curl -X POST http://localhost:8000/auth/register \
-H "Content-Type: application/json" \
-d '{"username": "john", "password": "pass123", "role": "user"}'
```

### Login
```bash
curl -X POST http://localhost:8000/auth/login \
-H "Content-Type: application/json" \
-d '{"username": "john", "password": "pass123"}'
```

### Get All Users (Admin only)
```bash
curl -X GET http://localhost:8000/users/ \
-H "Authorization: Bearer <ACCESS_TOKEN>"
```

## ğŸ§ª Running Tests
```bash
pytest --cov=app --cov-report=term-missing
```

## ğŸ“Š ER Diagram
```
+-----------+ +---------------+
| users    |           | roles  |
+-----------+ +---------------+
| id (PK)  |        | id (PK)|
| name     |<-----> | name   |
| email    |
| password |
| role_id  |
+-----------+
```

## ğŸ“‚ Project Structure
```
role-based-user-management/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€  config.py
â”‚   â”‚   â”œâ”€â”€ deps.py
â”‚   â”‚   â””â”€â”€ security.py
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â””â”€â”€ base.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ common.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ crud/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ user_service.py
â”‚
â”œâ”€â”€ alembic/
â”‚   â””â”€â”€ (auto-generated by Alembic)
|
â”œâ”€â”€ tests/
â”‚    â”‚
â”‚    â”œâ”€â”€ __init__.py
â”‚    â”œâ”€â”€ conftest.py
â”‚    â”œâ”€â”€ test_auth.py
â”‚    â””â”€â”€ test_users.py
â”‚
â”œâ”€â”€ alembic.ini
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```